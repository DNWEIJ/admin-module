<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout.html}">
<head>
    <title>Functie settings</title>
</head>
<body>
<section layout:fragment="content">
    <th:block th:insert="~{fragments/elements/pagetitle::pageTitle(${id}, 'Supply','/supplies/list')}"></th:block>

    <form action="/supplies" method="post">
        <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden"/>
        <th:block th:insert="~{fragments/elements/buttons::saveAndNewButtons}"></th:block>

        <!-- hidden identifiers -->
        <input id="id" name="id" th:value="${id}" type="hidden"/>
        <input id="version" name="version" th:value="${version}" type="hidden"/>

        <fieldset class="grid" role="presentation">
            <th:block th:insert="~{fragments/elements/input::inputHtml('nomenclature','Description','nomenclature','1')}"></th:block>
            <th:block th:insert="~{fragments/elements/dropdown::dbDropdown('distributor','Distributor','supply.distributor.id',${distributorList},false,'2')}"></th:block>
        </fieldset>
        <fieldset class="grid" role="presentation">
            <th:block th:insert="~{fragments/elements/input::inputHtml('price','Price [each]','price','3')}"></th:block>
            <th:block th:insert="~{fragments/elements/input::inputHtml('quantityPerPackage','Individual Qty/Pkg','quantityPerPackage','4')}" th:with="type='number'"></th:block>
            <th:block th:insert="~{fragments/elements/input::inputHtml('minQuantity','Minimum Quantity','minQuantity','5')}" th:with="type='number'"></th:block>
            <th:block th:insert="~{fragments/elements/input::inputHtml('buyQuantity','Buy Quantity','buyQuantity','6')}" th:with="type='number'"></th:block>
        </fieldset>
        <fieldset class="grid" role="presentation">
            <th:block th:insert="~{fragments/elements/input::inputHtml('itemNumber','Item Number','itemNumber','7')}" th:with="required=false"></th:block>
            <th:block th:insert="~{fragments/elements/input::inputHtml('barcode','Barcode Number','barcode','8')}" th:with="required=false"></th:block>
        </fieldset>
        <fieldset class="grid" role="presentation">
            <label for="distDescription">Distributor Description
                <textarea cols="60" id="distDescription" name="distDescription" rows="3" tabindex="9" th:text="${distDescription}"></textarea>
            </label>
        </fieldset>

        <!-- Tabs (optional, can be filled later) -->
        <div id="tabs" style="display:none">
            <ul>
                <li><a href="#ui-tabs-6">Location Inventory</a></li>
            </ul>
            <div id="ui-tabs-6">
                <!-- location inventory content -->
            </div>
        </div>
    </form>


    <label for="euros">Amount (â‚¬)</label>
    <div style="display:flex; gap:4px; align-items:center;">
        <input id="euros" min="0" name="euros" placeholder="0" step="1" style="width:6em;" type="number">
        <span>,</span>
        <input id="cents" max="99" min="0" name="cents" placeholder="00" step="1" style="width:5em;" type="number">
    </div>
    <input id="amountCents" name="amountCents" type="hidden">

    <script>
        const eurosInput = document.getElementById('euros');
        const centsInput = document.getElementById('cents');
        const hiddenCents = document.getElementById('amountCents');

        // Move focus from euros to cents when comma is pressed
        eurosInput.addEventListener('keydown', (e) => {
            if (e.key === ',' || e.key === '.') { // comma or dot triggers jump
                e.preventDefault();
                centsInput.focus();
                centsInput.select(); // select existing value if any
            }
        });

        // Clamp cents input to 0-99
        centsInput.addEventListener('input', () => {
            let val = parseInt(centsInput.value, 10);
            if (isNaN(val) || val < 0) val = 0;
            if (val > 99) val = 99;
            centsInput.value = String(val).padStart(2, '0');
        });

        // On submit, calculate total cents
        document.getElementById('payForm').addEventListener('submit', (e) => {
            const euros = parseInt(eurosInput.value, 10) || 0;
            const cents = parseInt(centsInput.value, 10) || 0;
            hiddenCents.value = euros * 100 + cents;
        });
    </script>
</section>