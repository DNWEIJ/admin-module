<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{/layout.html}">
<head>
    <title>[[#{label.title.visit}]]</title>
</head>
<body>
<section layout:fragment="content">
    <!-- TODO activate -->
    <!--    <script>-->
    <!--        window.addEventListener("beforeunload", function (event) {-->
    <!--            event.preventDefault();-->
    <!--            event.returnValue = "";-->
    <!--        });-->
    <!--    </script>-->

    <div id="visit-page">
        <div id="actionbar">
            <th:block th:insert="~{/consult-module/fragments/htmx/actionbar}"></th:block>
        </div>
         <th:block th:insert="~{sales-module/fragments/appointmentlist}"></th:block>
        <th:block
                th:insert="~{sales-module/fragments/customerpetinfo::customerPetInfo(${customer}, ${visit.pet}, false)}"></th:block>

        <details id="visitInfo" open>
            <summary>
                <span th:text="#{visit.info.title}"></span><a href="/info/visitinfo" title="More info" class="info-icon">‚ÑπÔ∏è</a>
            </summary>
            <fieldset class="grid">
                <!-- define extra buttons to add behind -->
                <th:block th:with="extras=~{sales-module/fragments/extrabuttons::historySoapNoteButtons}">
                    <th:block
                            th:insert="~{sales-module/fragments/petdropdownandbuttons::petDropDownAndButtons(${petsOnAppointment}, ${visit.pet}, ${customer}, ${visit}, ${appointment}, ${extras},${visit.isOpen?false:true})}"></th:block>
                </th:block>
            </fieldset>
            <form id="visitForm" method="post">
                <input name="id" th:value="${visit.id}" type="hidden"/>
                <input name="version" th:value="${visit.version}" type="hidden"/>
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>


                <fieldset class="grid">
                    <th:block
                            th:insert="~{fragments/elements/dropdown::dbDropdown('veterinarian','visit.staff',${visit.veterinarian}, ${staffList}, false, '3')}"></th:block>
                    <th:block
                            th:insert="~{fragments/elements/dropdown::dbDropdown('room','visit.room',${visit.room}, ${rooms}, false, '6')}"></th:block>
                    <th:block
                            th:insert="~{fragments/elements/dropdown::propDropdown('sentToInsurance','visit.insurance',${visit.sentToInsurance}, ${ynvaluesList}, false, '4')}"></th:block>
                </fieldset>
                <fieldset class="grid" style="margin-top: 1rem">
                    <th:block
                            th:insert="~{fragments/elements/input::inputHtmlLift('purpose','visit.purpose','visit.purpose','1')}"></th:block>
                </fieldset>
                <fieldset class="grid">
                    <div class="icon-plus-input">
                        <div class="center-align-svg">
                            <a href=""
                               th:hx-get="${'/consult/visit/customer/'+ customer.id + '/pet/'  + visit.pet.id + '/history/weight'}"
                               hx-target="#modal-container" hx-swap="innerHTML"/>
                            <svg class="svg-icon">
                                <use href="/lib/tabler-icons-3_35_0/icons/outline/history.svg"></use>
                            </svg>
                            </a>
                        </div>
                        <div>
                            <th:block
                                    th:insert="~{fragments/elements/input::inputHtmlLift('weight','visit.weight','visit.weight','2')}"
                                    th:with="required=false"></th:block>
                        </div>
                    </div>
                    <th:block
                            th:insert="~{fragments/elements/input::inputHtmlLift('temperature','visit.temperature','visit.temperature','5')}"
                            th:with="required=false"></th:block>
                    <th:block
                            th:insert="~{fragments/elements/input::inputHtmlLift('glucose','visit.glucose','visit.glucose','7')}"
                            th:with="required=false"></th:block>
                </fieldset>
                <th:block
                        th:insert="~{/consult-module/fragments/templatelocalmemberpref::template('template', ${templates})}"></th:block>
                <th:block
                        th:insert="~{fragments/elements/audit::audit('visit.addedBy','visit.addedOn', 'visit.lastEditedBy', 'visit.lastEditedOn')}"></th:block>
                <div>
                    <button name="_save" type="submit" form="visitForm" th:text="#{label.button.save}"></button>
                </div>
            </form>
        </details>
        <details id="analyses" open>
            <summary>
                <span th:text="#{visit.analyse.title}"></span><a href="/info/customerpetinfo" title="More info"
                                                                 class="info-icon">‚ÑπÔ∏è</a>
            </summary>
            <div id="analyseReplaceHtmx">
                <th:include th:replace="~{consult-module/visit/analyse}"></th:include>
            </div>
        </details>
        <details id="lineitems" open>

            <summary class="three-elements">
                <a href="" th:title="#{visit.lineitems.history}"
                   th:hx-get="${'/consult/visit/customer/'+ customerId + '/pet/'  + petId + '/history/product'}"
                   hx-target="#modal-container"
                   hx-swap="innerHTML">Ô∏èüõí</a>
                <span class="center-text" th:text="#{label.otc.legend.lineitems}"></span>
                <a href="/info/lineiteminfo" title="More info" class="info-icon">‚ÑπÔ∏è</a>
            </summary>

            <table id="lineItemsTable" class="no-sorting table-tight striped">

                <!-- body and footer -->
                <div id="lineItemsOverviewReplaceHtmx">
                    <th:include th:replace="~{sales-module/fragments/htmx/lineitemsfulltable}"></th:include>
                </div>
            </table>
            <!-- TODO: Check on visit isOpen -->
            <div id="replacePartForCostingSearch" th:if="${!(appointment.isCancelled || appointment.isCompleted)}"
                 th:insert="~{supplies-module/fragments/costing/costingSearch::costingSearch(true)}"></div>
        </details>
        <details id="diagnose" open>

            <summary class="three-elements">
                <a href="" th:title="#{visit.diagnose.history}"
                   th:hx-get="${'/consult/visit/customer/'+ customer.id + '/pet/'  + visit.pet.id + '/history/diagnose'}"
                   hx-target="#modal-container" hx-swap="innerHTML">üè∑Ô∏è</a>
                <span class="center-text" th:text="#{label.diagnose}"></span>
                <a href="/info/visitinfo" title="More info" class="info-icon">‚ÑπÔ∏è</a>
            </summary>

            <div id="replaceDiagnose" th:insert="~{consult-module/fragments/diagnose::diagnose()}"></div>
        </details>
    </div>
</section>
</body>
</html>