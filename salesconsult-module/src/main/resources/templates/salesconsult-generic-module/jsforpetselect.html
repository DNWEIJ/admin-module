<script th:inline="javascript">
    function addEventListenersForPetSelect() {
        // Attach listener to all dropdowns starting with 'reasonList['  copy the purpose and check the checkbox
        document.querySelectorAll("select[id^='reasonList']").forEach(select => {
            select.addEventListener("change", function () {
                const index = this.id.match(/\[(\d+)\]/)[1]; // extract index houseNumber

                // Find matching input + checkbox
                const purposeInput = document.getElementById(`formPet[${index}].purpose`);
                const checkBox = document.getElementById(`formPet[${index}].checked`);
                const purposeSelect = document.getElementById(`reasonList[${index}].reason`);

                if (purposeInput) purposeInput.value = purposeSelect.options[purposeSelect.selectedIndex].text;
                if (checkBox) checkBox.checked = true;
                // now if we are creating an appointment, we need to handle the reason -> time setting
                const timeFromReasonSelect = document.getElementById(`formPet[${index}].timeNeeded`);
                if (timeFromReasonSelect) {
                    timeFromReasonSelect.value =
                        purposeSelect.options[purposeSelect.selectedIndex].dataset.element;
                }
            });
        });
        // add to staff and room to set checkbox
        document.querySelectorAll("select[id^='formPet'][id$='.vet'], select[id^='formPet'][id$='.room']").forEach(select => {
            select.addEventListener("change", function () {
                const index = this.id.match(/\[(\d+)\]/)[1]; // extract index houseNumber
                // Find checkbox
                const checkBox = document.getElementById(`formPet[${index}].checked`);
                if (checkBox) checkBox.checked = true;
            })
        })

        // prevent submitting the form if no checkbox is checked
        document.getElementById('createForm').addEventListener("submit", function (e) {
            if (!this.querySelectorAll('input[type=checkbox]:checked').length) {
                // @formatter:off
                alert([[#{label.otc.pet.checkbox.error}]])
                // @formatter:on
                e.preventDefault();
            }
        });
    }
    document.addEventListener("DOMContentLoaded", addEventListenersForPetSelect);
</script>