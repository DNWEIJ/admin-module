<th:block th:fragment="customerSearch(saveButton, url, salesType)">
    <script>
        let baseUrl;
        let selectedIndex = -1;

        function updateSelection(listItems) {

            if (listItems.length === 0) return;
            listItems.forEach((li, index) => {
                li.classList.toggle("selected", index === selectedIndex);
                if (index === selectedIndex) {
                    li.scrollIntoView({block: "nearest"});
                }
            });
        }

        function getId(listItems) {

            if (listItems.length === 0) return;
            return Array.from(listItems).filter(li => li.classList.contains("selected"))[0].dataset.id
        }

        function getListItems() {
            return document.querySelectorAll("#input-customerName li");
        }

        function attachMouseHandlers() {
            const listItems = getListItems();

            listItems.forEach((li, index) => {
                li.addEventListener("mouseenter", () => {
                    // highlight hovered item
                    selectedIndex = index;
                    updateSelection(listItems);
                });

                li.addEventListener("click", (event) => {
                    window.location.href = `${window.location.origin}[[${url}]]` + getId(getListItems());
                    event.preventDefault();
                });
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            attachMouseHandlers()
            baseUrl = window.location.href;
            const input = document.getElementById("customerFind");
            selectedIndex = -1;
            input.addEventListener("keydown", (event) => {

                if (event.key === "ArrowDown") {
                    const listItems = getListItems()
                    if (listItems.length === 0) return;

                    if (selectedIndex < listItems.length - 1) {
                        selectedIndex++;
                        updateSelection(listItems);
                    } else if (selectedIndex === -1 && listItems.length > 0) {
                        selectedIndex = 0;
                        updateSelection();
                    }
                    event.preventDefault();
                }
                if (event.key === "ArrowUp") {
                    const listItems = getListItems()
                    if (listItems.length === 0) return;

                    if (selectedIndex > 0) {
                        selectedIndex--;
                        updateSelection(listItems);
                    }
                    event.preventDefault();
                }
                if (event.key === "Enter") {
                    window.location.href = `${window.location.origin}[[${url}]]` + getId(getListItems());
                    event.preventDefault();
                }
            })
        })
    </script>
    <div class="gridSearchCustomerWithCheck">
        <div id="holder" class="holder">
            <input list="input-customerName" id="customerFind" class="no-break" type="search" name="searchCriteria"
                   th:placeholder="#{label.customer.search.placeholder}" th:data-alternatetext="#{label.customer.search.explenation}" autofocus
                   hx-get="/customer/search/customer"
                   hx-trigger="input[this.value.length >=2] changed delay:500ms, keyup[key=='Enter'], load"
                   hx-target="#input-customerName"
                   hx-indicator="#searching-indicator"
                   hx-include="#startLastName, #includeStreetName, #includeFirstTel, #includePet"
                   autocomplete="off"
                   style="transition: opacity .4s;">
            <span id="searching-indicator" class="htmx-indicator">
                <span aria-busy="true" style="color: red">
                    <strong th:text="#{label.customer.search.search}"></strong></span>
            </span>
            <div class="ac_results_wrapper">
                <div class="ac_results" id="input-customerName" hx-on::after-swap="attachMouseHandlers()"></div>
            </div>
        </div>
        <div class="checkbox-group">
            <!-- using switch with tooltip needs adjustment of CSS -->
            <th:block th:insert="~{fragments/elements/select::checkBox('startLastName','','form.startLastName','0')}" th:with="tooltip=#{label.tooltip.customer.name}, switch='switch'"></th:block>
            <th:block th:insert="~{fragments/elements/select::checkBox('includeStreetName','','form.includeStreetName','0')}"
                      th:with="tooltip=#{label.tooltip.customer.street}, switch='switch'"></th:block>
            <th:block th:insert="~{fragments/elements/select::checkBox('includeFirstTel','','form.includeFirstTel','0')}"
                      th:with="tooltip=#{label.tooltip.customer.firstel}, switch='switch'"></th:block>
            <th:block th:insert="~{fragments/elements/select::checkBox('includePet','','form.includePet','0')}" th:with="tooltip=#{label.tooltip.customer.pet}, switch='switch'"></th:block>
        </div>
        <div role="group">
            <input th:if="${salesType == null}" class="secondary" name="_reset" type="button" th:value="#{label.button.reset}" onclick="window.location.href=window.location.origin + '/customer/customer?isNew=true'"/>
            <input th:if="${saveButton}" name="_save" type="submit" th:value="#{label.button.save}" form="createForm"/>
        </div>
    </div>
    <script>
        function alternateTextPlaceHolder() {
            const input = document.getElementById('customerFind');
            let count = 0;
            const timer = setInterval(() => {
                if (++count > 3) return clearInterval(timer);
                input.style.opacity = 0;
                setTimeout(() => {
                    [input.placeholder, input.dataset.alternatetext] =
                        [input.dataset.alternatetext, input.placeholder];
                    input.style.opacity = 1;
                }, 200);
            }, 5000);
        }
        alternateTextPlaceHolder();
    </script>
</th:block>